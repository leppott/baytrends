---
title: "Vignette, QW"
author: "Erik.Leppo@tetratech.com"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette, QW}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
<!-- Data is in vignettes\data folder  -->
```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
# Purpose
The qw object was created for the storage of water quality data.  It was developed for the `smwrQW` package but this package was orphaned by USGS in the summer of 2017.  The `baytrends` package depends on qw objects and thus many of the qw functions were imported from the smwr family of packages into this package.

This vignette will cover the basics of exporting and importing data as a qw object.

# Export
The `baytrends` package included the dataCensored data that will be used in this example.

Exporting a qw object will generate a data frame for each qw field in the dataframe.  The columns of the output file will include the non-qw columns and a column for each of the components of the qw field.

```{r Export, eval=FALSE}
library(baytrends)

# define data frame with qw column classes
myDF <- dataCensored

# directory to save output
## this example uses a sub directory of the current working directory named "data" 
dir.save <- file.path(".", "data")

# prefix for file names ()
fn.prefix <- "dataCensored" 

# run function
qw.export(myDF, dir.save, fn.prefix)

```

The raw data is named A.B.tsv.

* The file format is tab separate (tsv).
* A = name of data frame
* B = variable name

The columns of the data file are in the format of X.Y.

* X = column name
* Y = qw argument (slot name)

The structure and first few records of an example file are shown below.
```{r RawDataFormat}
df <- read.delim("./data/dataCensored.chla.tsv")
str(df)
head(df)

```

There are 10 slot names for a qw object (see below).  The slot for rounding is special and is included in a separate file or is defined as a vector (e.g., c(3, 4).
```{r SlotNames}
library(baytrends)
slotNames("qw")
```

# Import
To create a qw object the data needs to be in the format that was generated by qw.export.  That is, one file for each data column.  Each file needs to contain the same number of rows and include the same non-qw columns.  The included dataset dataCensored will be used for this example.

The qw.import function returns a data frame so it will need to be directed to a variable.  Any modification of column classes (e.g., POSIXct, numeric, or integer) will need to be performed by the user.  The function str() is useful for examing the structure of the data frame.

```{r Import, eval=FALSE}
library(baytrends)

# Reimport dataCensored as a new dataframe

var.qw <- c("secchi", "chla", "do", "tn", "tp", "po4f", "pp", "tdp"
              , "no23f", "nh4f", "tdn", "pn", "tss")
var.info <- c("station", "date", "layer")
fn.qw <- paste0("./data/dataCensored.", var.qw, ".tsv")
rounding.source <- "file" # file or value or NA (default)
rounding.file <- paste0("dataCensored.", var.qw, ".rounding.tsv")
rounding.value <- c(3, 4) #default is c(2, 3)
rounding.data <- rounding.file

dataCensored.test<- qw.import(var.qw, var.info, fn.qw, dir.data=getwd()
                              , rounding.source=rounding.source
                              , rounding.data=rounding.value)
str(dataCensored.test)

# convert date field to POSIXct
dataCensored.test[,"date"] <- as.POSIXct(dataCensored.test[,"date"])
str(dataCensored.test)

# as.numeric() and as.integer() can be used to convert columns of those types.

save(dataCensored.test, file="./data/dataCensored.test.rda")



```




