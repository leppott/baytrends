---
title: "Vignette, QW"
author: "Erik.Leppo@tetratech.com"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette, QW}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
<!-- Data is in vignettes\data folder  -->
```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```
# Purpose
The qw object was created for the storage of water quality data.  It was developed for the `smwrQW` package but this package was orphaned by USGS in the summer of 2017.  The `baytrends` package depends on qw objects and thus many of the qw functions were imported from the smwr family of packages into this package.

This vignette will cover the basics of exporting and importing data as a qw object.

# Export
The `baytrends` package includes the dataCensored data that will be used in this example.

Exporting a qw object will generate a single data frame with three columns for each qw field in the dataframe.  The three qw related columns of the output file will include the data (lo and hi value) and the remark code (symbol).

```{r Export, eval=FALSE}
library(baytrends)

# define data frame with qw column classes
myDF <- dataCensored

# directory to save output
## this example uses a sub directory of the current working directory named "data" 
dir.save <- file.path(getwd(), "data")

# prefix for file names ()
fn.output <- "dataCensored_TEST.csv" 

# run function
qw.export(myDF, dir.save, fn.output)

```

The raw data is named dataCensored_TEST.csv.

* The file format is comma separated (csv).

The columns of the data file are in the format of X.Y.

* X = column name
* Y = qw argument (slot name)

The structure and first few records of an example file are shown below.

The slot names used in the file are "_lo", "_hi", and "_symbol".  These correlate to 
the qw slot names .Data.values, .Data.value2, and remark.codes.
```{r RawDataFormat}
df <- read.csv("./data/dataCensored_TEST.csv")

str(df)

head(df[,1:9])
```

There are 10 slot names for a qw object (see below) but only the first 2 slots are used. 
The slot for rounding is special and is included in a separate file or is defined as a vector (e.g., c(3, 4).  The rounding value defaults to 3, 4 but can be modified in qw.import.
```{r SlotNames}
library(baytrends)
slotNames("qw")
```

# Import
To create a qw object the data needs to be in the format that was generated by qw.export.  That is, one file with each qw parameter having three columns (x_lo, x_hi, and x_symbol where x is the name of the parameter).  See previous example.

The qw.import function returns a data frame so it will need to be directed to a variable.  Any modification of column classes (e.g., POSIXct, numeric, or integer) will need to be performed by the user.  The function str() is useful for examing the structure of the data frame.

```{r Import, eval=FALSE}
library(baytrends)

# Import Test file as a qw object

# Define function parameters
fn.import <- file.path(".", "data", "dataCensored_TEST.csv")
qw.names <- c("secchi", "chla", "do", "tn", "tp", "po4f", "pp", "tdp"
              , "no23f", "nh4f", "tdn", "pn", "tss")
rounding <- c(3, 4)

# Import
dataCensored.test<- qw.import(fn.import, qw.names, rounding)

# Check for qw class
str(dataCensored.test)

# convert date field to POSIXct (if desired)
dataCensored.test[,"date"] <- as.POSIXct(dataCensored.test[,"date"])
str(dataCensored.test) # recheck structure
# as.numeric() and as.integer() can be used to convert columns of those types.

# Save
save(dataCensored.test, file="./data/dataCensored.test.rda")
```




