<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vignette, QW • baytrends</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Vignette, QW">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">baytrends</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets.html">Vignette, Create Seasonally Detrended Flow and Salinity Data Sets</a>
    </li>
    <li>
      <a href="../articles/vignette_qw.html">Vignette, QW</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tetratech/baytrends">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Vignette, QW</h1>
                        <h4 class="author">
<a href="mailto:Erik.Leppo@tetratech.com" class="email">Erik.Leppo@tetratech.com</a> and <a href="mailto:Jon.Harcum@tetratech.com" class="email">Jon.Harcum@tetratech.com</a>
</h4>
            
            <h4 class="date">2019-11-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tetratech/baytrends/blob/master/vignettes/vignette_qw.Rmd"><code>vignettes/vignette_qw.Rmd</code></a></small>
      <div class="hidden name"><code>vignette_qw.Rmd</code></div>

    </div>

    
    
<!-- Data is in vignettes\data folder  -->
<div id="purpose" class="section level1">
<h1 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h1>
<p>The purpose of this vignette is to cover the basics of exporting and importing water quality data for use in baytrends. In order to have the functionality to deal with censored data, when it exists, the qw object is used in baytrends to store all water quality data. The process of combining two (or more) data frames with qw objects is also described.</p>
<p>The qw object was originally developed by the U.S. Geological Survey (USGS) for use in their <code>smwrQW</code> package. For future portability to the CRAN, numerous ‘smwrQW’ functions along with several supporting functions from USGS’ family of smwr packages were incorporated into this package.</p>
</div>
<div id="background" class="section level1">
<h1 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h1>
<p>Monitoring programs may report laboratory results where the concentration is below the detection limit of the analysis. Bacteriological tests may report very high results as “too numerous to count” (TNTC). Such data typically reported as “&lt;” or “&gt;” some value, x, are referred to as censored data. Censored values are usually associated with limitations of measurement or sample analysis, and are commonly reported as results below or above measurement capacity of the available analytical equipment. Results that are indistinguishable from a blank sample are normally reported as less than the detection limit (DL). The true values of these left-censored observations are considered to lie between zero and the DL. Depending on the laboratory, some results greater than the DL may be identified as less than the quantitation limit (QL) or reported as a single value and given a data qualifier to indicate the value is less than the QL. Typically, results reported as less than the QL indicate that the analyte was detected (i.e., greater than the detection limit), but at a low enough concentration where the precision was deemed too low to reliably report a single value. These interval-censored observations are considered to lie between the DL and QL. Interval-censored observations can also occur when calculating a chemical concentration based on adding or differencing multiple measured concentrations.</p>
<p>Data censoring leads to a loss of information and makes statistical analyses more challenging. Thus beginning in 1999, the Chesapeake Bay Program began to store the uncensored results of chemical measurements. Nevertheless, the Chesapeake Bay Program is interested in performing trend analyses with data back to 1985. Therefore, baytrends was developed explicitly developed to allow for multiple types of censored data.</p>
</div>
<div id="export" class="section level1">
<h1 class="hasAnchor">
<a href="#export" class="anchor"></a>Export</h1>
<p><strong>Use the function <em>qw.export</em> to export “qw” formatted data.</strong> The sample data set, <code>dataCensored</code>, included with <code>baytrends</code>, is used for demonstration.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(baytrends)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># load the included data frame, dataCensored, into the global environment</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># dataCensored is a sample data set that includes qw formatted data and</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># is included with baytrends.</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>myDF &lt;-<span class="st"> </span>dataCensored</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># identify the current working directory as the location to save </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># the outputted data set</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>dir.save &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span>()</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># identify the name of the comma delimited (csv) file for the </span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># outputted data set </span></span>
<span id="cb1-14"><a href="#cb1-14"></a>fn.output &lt;-<span class="st"> "dataCensored_TEST.csv"</span> </span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co"># run function</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="kw"><a href="../reference/qw.export.html">qw.export</a></span>(myDF, dir.save, fn.output)</span></code></pre></div>
<p>The above code chunk will output the raw data to a comma delimited (csv) file named <code>dataCensored_TEST.csv</code>. For non-qw variables (such as station, date, and layer in this example), the column names in the csv file are the same as the data frame. For qw-formatted variables, the columns of the data file are in the format of X_Y.</p>
<ul>
<li>X = column name<br>
</li>
<li>Y = qw argument of “lo”, “hi”, and “symbol”</li>
</ul>
<p>In the context of water quality data, left-censored observations such as “&lt;0.1” would have a lo value of 0 and a hi value of 0.1. Interval-censored observations would have a non-zero lo value. The value of symbol would be “&lt;” and “i”, respectively for left- and interval-censored observations. Uncensored observations would have lo and hi values equal to each other.</p>
<p>Selected columns from the first few records of the above example are shown below.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>df &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"dataCensored_TEST.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(df[,<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,<span class="dv">16</span><span class="op">:</span><span class="dv">24</span>)])</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">station</th>
<th align="left">date</th>
<th align="left">layer</th>
<th align="right">tp_lo</th>
<th align="right">tp_hi</th>
<th align="left">tp_symbol</th>
<th align="right">po4f_lo</th>
<th align="right">po4f_hi</th>
<th align="left">po4f_symbol</th>
<th align="right">pp_lo</th>
<th align="right">pp_hi</th>
<th align="left">pp_symbol</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">CB3.3C</td>
<td align="left">1985-01-23</td>
<td align="left">B</td>
<td align="right">0.028</td>
<td align="right">0.028</td>
<td align="left"></td>
<td align="right">0.0000</td>
<td align="right">0.0070</td>
<td align="left">&lt;</td>
<td align="right">0.016</td>
<td align="right">0.028</td>
<td align="left">i</td>
</tr>
<tr class="even">
<td align="left">CB3.3C</td>
<td align="left">1985-01-23</td>
<td align="left">S</td>
<td align="right">0.030</td>
<td align="right">0.030</td>
<td align="left"></td>
<td align="right">0.0000</td>
<td align="right">0.0070</td>
<td align="left">&lt;</td>
<td align="right">0.018</td>
<td align="right">0.030</td>
<td align="left">i</td>
</tr>
<tr class="odd">
<td align="left">CB3.3C</td>
<td align="left">1985-02-13</td>
<td align="left">B</td>
<td align="right">0.043</td>
<td align="right">0.043</td>
<td align="left"></td>
<td align="right">0.0000</td>
<td align="right">0.0070</td>
<td align="left">&lt;</td>
<td align="right">0.033</td>
<td align="right">0.043</td>
<td align="left">i</td>
</tr>
<tr class="even">
<td align="left">CB3.3C</td>
<td align="left">1985-02-13</td>
<td align="left">S</td>
<td align="right">0.021</td>
<td align="right">0.021</td>
<td align="left"></td>
<td align="right">0.0000</td>
<td align="right">0.0070</td>
<td align="left">&lt;</td>
<td align="right">0.011</td>
<td align="right">0.021</td>
<td align="left">i</td>
</tr>
<tr class="odd">
<td align="left">CB3.3C</td>
<td align="left">1985-03-05</td>
<td align="left">B</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left"></td>
<td align="right">0.0108</td>
<td align="right">0.0108</td>
<td align="left"></td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">CB3.3C</td>
<td align="left">1985-03-05</td>
<td align="left">S</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left"></td>
<td align="right">0.0040</td>
<td align="right">0.0040</td>
<td align="left"></td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div id="import" class="section level1">
<h1 class="hasAnchor">
<a href="#import" class="anchor"></a>Import</h1>
<p><strong>Use the function <em>qw.import</em> to import “qw” formatted data.</strong> The above exported file, <code>dataCensored_TEST.csv</code>, is used for demonstration.</p>
<p>To create a data frame that includes qw objects, the data needs to be in the format that was generated by qw.export. That is, one file with each qw parameter having three columns (x_lo, x_hi, and x_symbol where x is the name of the parameter). The list of parameter codes that will be as column names of the qw-formatted variables are specifed in the argument <code>qw.names</code>.</p>
<p>The output of the <code>qw.import</code> function must be directed to a variable. Any modification of column classes (e.g., POSIXct, numeric, or integer) will need to be performed by the user. The function str() is useful for examing the structure of the data frame.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(baytrends)</span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co"># Define function arguments</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>fn.import &lt;-<span class="st"> "dataCensored_TEST.csv"</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>qw.names &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"secchi"</span> ,  <span class="st">"salinity"</span>, <span class="st">"do"</span>  ,     <span class="st">"wtemp"</span>  ,  <span class="st">"chla"</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>              ,<span class="st">"tn"</span>     ,  <span class="st">"tp"</span>    ,   <span class="st">"tss"</span> ,     <span class="st">"din"</span>  ,    <span class="st">"po4"</span>      </span>
<span id="cb3-7"><a href="#cb3-7"></a>              ,<span class="st">"tdn"</span>     , <span class="st">"tdp"</span>  ,    <span class="st">"nh4"</span>  ,    <span class="st">"no23"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="co"># fun function </span></span>
<span id="cb3-10"><a href="#cb3-10"></a>dataCensored.test&lt;-<span class="st"> </span><span class="kw"><a href="../reference/qw.import.html">qw.import</a></span>(fn.import, qw.names)</span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="co"># Check for qw class</span></span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(dataCensored.test)</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co"># convert date field to POSIXct  </span></span>
<span id="cb3-16"><a href="#cb3-16"></a>dataCensored.test[,<span class="st">"date"</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.POSIXlt.html">as.POSIXct</a></span>(dataCensored.test[,<span class="st">"date"</span>])</span>
<span id="cb3-17"><a href="#cb3-17"></a></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co"># recheck structure (other columns can be converted using</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co"># as.numeric() and as.integer() if desired)</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(dataCensored.test) </span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co"># save the data frame for future use</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="kw"><a href="https://rdrr.io/r/base/save.html">save</a></span>(dataCensored.test, <span class="dt">file=</span><span class="st">"dataCensored.test.rda"</span>)</span></code></pre></div>
</div>
<div id="combining-qw-data-frames" class="section level1">
<h1 class="hasAnchor">
<a href="#combining-qw-data-frames" class="anchor"></a>Combining QW Data Frames</h1>
<p><strong>Use the function <em>rbindQW</em> to combine two data frames with “qw” formatted data.</strong> The below code chunk demonstrates combining the data from two data frames.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(baytrends)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>newDF &lt;-<span class="st"> </span><span class="kw"><a href="../reference/rbindQW.html">rbindQW</a></span>(dataCensored[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>,], dataCensored[<span class="dv">101</span><span class="op">:</span><span class="dv">120</span>,])</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(newDF)</span>
<span id="cb4-5"><a href="#cb4-5"></a></span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="co"># Note, that it would have been equivalent and more efficient to</span></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># use the below line of code to extract rows 1-20 and 101-120</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>newDF &lt;-<span class="st"> </span>dataCensored[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>,<span class="dv">101</span><span class="op">:</span><span class="dv">120</span>),]</span></code></pre></div>
<div id="additional-notes" class="section level3">
<h3 class="hasAnchor">
<a href="#additional-notes" class="anchor"></a>Additional Notes</h3>
<p><code>qw.import</code> includes an optional third argument, <code>rounding</code>, that controls how the data are rounded when printed. This argument is an integer vector of length 2. The first element is the maximum number of significant figures and the second element is the maximum number of decimal places to show. The default value used is c(3, 4), but can be changed by modifying this option.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#purpose">Purpose</a></li>
      <li><a href="#background">Background</a></li>
      <li><a href="#export">Export</a></li>
      <li><a href="#import">Import</a></li>
      <li><a href="#combining-qw-data-frames">Combining QW Data Frames</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Erik Leppo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
