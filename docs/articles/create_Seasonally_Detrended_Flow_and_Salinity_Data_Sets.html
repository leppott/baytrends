<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Vignette, Create Seasonally Detrended Flow and Salinity Data Sets • baytrends</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Vignette, Create Seasonally Detrended Flow and Salinity Data Sets">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">baytrends</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets.html">Vignette, Create Seasonally Detrended Flow and Salinity Data Sets</a>
    </li>
    <li>
      <a href="../articles/vignette_qw.html">Vignette, QW</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/tetratech/baytrends">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Vignette, Create Seasonally Detrended Flow and Salinity Data Sets</h1>
                        <h4 class="author">
<a href="mailto:Jon.Harcum@tetratech.com" class="email">Jon.Harcum@tetratech.com</a> and <a href="mailto:Erik.Leppo@tetratech.com" class="email">Erik.Leppo@tetratech.com</a>
</h4>
            
            <h4 class="date">2019-11-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/tetratech/baytrends/blob/master/vignettes/create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets.Rmd"><code>vignettes/create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets.Rmd</code></a></small>
      <div class="hidden name"><code>create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets.Rmd</code></div>

    </div>

    
    
<!-- Data is in vignettes\data folder  -->
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>The purpose of this vignette is to cover the basics for creating seasonally detrended flow and seasonally detrended salinity data sets. These data sets are used in support of applying <strong>gam4</strong>. In gam4, the dependent variable is modeled with a non-linear term as a function of year; a seasonality term includes an interaction term which allows seasonality to vary over the period of record; and includes a hydrologic term that allows for factoring wet/dry conditions in the model.</p>
<p>The seasonally detrended flow and salinity data sets are created using the detrended.flow and detrended.salinity functions included in baytrends. Refer to the help for each of these functions (e.g., ??detrended.flow or ??detrended.salinity) for the specific computational steps involved with each function.</p>
</div>
<div id="load-baytrends" class="section level2">
<h2 class="hasAnchor">
<a href="#load-baytrends" class="anchor"></a>Load baytrends</h2>
<p>The first step is to load the baytrends library. Loading baytrends will result in loading multiple additional libraries as well.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(baytrends)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co">#&gt; Loading required package: lubridate</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; </span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt; Attaching package: 'lubridate'</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt; </span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt;     date</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; Loading required package: mgcv</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; Loading required package: nlme</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; This is mgcv 1.8-30. For overview type 'help("mgcv-package")'.</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; ** baytrends 1.1.0 Notice:** This software program is preliminary or provisional and is subject to revision. This software program is for testing only, no warranty, expressed or implied, is made as to the accuracy and functioning of the program and related program material nor shall the fact of distribution constitute any such warranty, and no responsibility is assumed by in connection therewith. This software is provided 'AS IS.'</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; </span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt; Attaching package: 'baytrends'</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt; </span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">#&gt;     View</span></span></code></pre></div>
</div>
<div id="seasonally-detrended-flow" class="section level2">
<h2 class="hasAnchor">
<a href="#seasonally-detrended-flow" class="anchor"></a>Seasonally Detrended Flow</h2>
<p>The function, <strong>detrended.flow</strong>, returns a list of seasonally detrended flow and companion statistics. It relies on USGS’ dataRetrieval package to retrieve daily flow data.</p>
<p><strong>It is the user’s responsibility to save the list that is returned from the detrended.flow function as flow.detrended for integration with baytrends.</strong></p>
<p>For purposes of the Chesapeake Bay Program, it is expected that the user would typically identify all nine of the <em>River Input Monitoring</em> (RIM) stations. The nine RIM stations for the Chesapeake Bay have been loaded as a data frame in baytrends, <strong>usgsGages</strong>.</p>
<p><em>Table 1. Chesapeake Bay River Input Monitoring Stations</em></p>
<table class="table">
<thead><tr class="header">
<th align="left">usgsGageID</th>
<th align="left">siteName</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01491000</td>
<td align="left">Choptank River near Greensboro, MD</td>
</tr>
<tr class="even">
<td align="left">01578310</td>
<td align="left">Susquehanna River at Conowingo, MD</td>
</tr>
<tr class="odd">
<td align="left">01594440</td>
<td align="left">Patuxent River near Bowie, MD</td>
</tr>
<tr class="even">
<td align="left">01646500</td>
<td align="left">Potomac River at Chain Bridge, Washington, DC</td>
</tr>
<tr class="odd">
<td align="left">01668000</td>
<td align="left">Rappahannock River near Fredericksburg, VA</td>
</tr>
<tr class="even">
<td align="left">01673000</td>
<td align="left">Pamunkey River near Hanover, VA</td>
</tr>
<tr class="odd">
<td align="left">01674500</td>
<td align="left">Mattaponi River near Beulahville, VA</td>
</tr>
<tr class="even">
<td align="left">02035000</td>
<td align="left">James River at Cartersville, VA</td>
</tr>
<tr class="odd">
<td align="left">02041650</td>
<td align="left">Appomattox River at Matoaca, VA</td>
</tr>
</tbody>
</table>
<p>The below code chunk is an example of retrieving and seasonally detrending daily flow data for all nine of the RIM stations from 1983-2017. To retrieve data for other USGS gages, the variables, usgsGagesID and siteName would be assigned with vectors that contain the list of USGS gage IDs and their site names. The vector of gage IDs are used to retrieve data while the vector of siteNames is used for diagnostic plots created by the function, detrend.flow.</p>
<p>To best match up with water quality data, we recommend retrieving flow data for one year prior to the first year of water quality data. This allows for creating a time-averaged flow data set and not loose the first few months of water quality data due to lack of matching flow data. Data retrievals should also be made in light of the time needed by the USGS to review and approve their flow records.</p>
<p>Information about the settings for dvAvgWinSel, dvAvgWgtSel, dvAvgSidesSel, lowess.f, span, and max.fill are described in the help file for this function.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Define Function Inputs</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>usgsGageID    &lt;-<span class="st"> </span>usgsGages<span class="op">$</span>usgsGageID <span class="co"># all RIM stations</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>siteName      &lt;-<span class="st"> </span>usgsGages<span class="op">$</span>siteName   <span class="co"># all RIM stations</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>yearStart     &lt;-<span class="st"> </span><span class="dv">1983</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>yearEnd       &lt;-<span class="st"> </span><span class="dv">2017</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>dvAvgWinSel   &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>, <span class="dv">90</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">180</span>, <span class="dv">210</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>dvAvgWgtSel   &lt;-<span class="st"> "uniform"</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>dvAvgSidesSel &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>lowess.f      &lt;-<span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co"># Run detrended.flow function</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>flow.detrended &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detrended.flow.html">detrended.flow</a></span>(usgsGageID, siteName, yearStart, yearEnd</span>
<span id="cb2-13"><a href="#cb2-13"></a>                                 , dvAvgWinSel, dvAvgWgtSel, dvAvgSidesSel</span>
<span id="cb2-14"><a href="#cb2-14"></a>                                 , lowess.f)</span>
<span id="cb2-15"><a href="#cb2-15"></a></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co"># Save list to data file separate use</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="kw"><a href="https://rdrr.io/r/base/save.html">save</a></span>(flow.detrended, <span class="dt">file=</span><span class="st">'mySeasonallyDetrendedFlow.rda'</span>)</span></code></pre></div>
<div id="example" class="section level3">
<h3 class="hasAnchor">
<a href="#example" class="anchor"></a>Example</h3>
<p>The following five figures Figures 1-5 provide an example analysis for the USGS gage on the Susquehanna River at Conowingo, Maryland. Figure 1 displays the daily flow values [cms] as a function of the day of year for data from 2003-2017. The solid red line represents the predicted GAM using the function Log(Q)~s(doy,bs=‘cc’).</p>
<p>Subtracting the predicted GAM from the observations yields the observations plotted in Figure 2. The ordinate is plotted on a log scale since the predicted GAM and observations were log transformed. We also refer to this as the 1-day-smoothed residuals. A 10-day-smoothed residual is displayed in Figure 3. Using the above settings for dvAvgWgtSel (“uniform”) and dvAvgSidesSel (1), the 10-day smoothed residual is the average of the preceeding nine days and the current day of the 1-day-smoothed residual. That is, the value on June 10, 2015 is equal to the average of the values from June 1-10, 2015. As the number of days used in the averaging process increases, the range of residuals decreases. These x-day smoothed residuals are used in gam4 and can be thought of an indicator of how wet or dry a particular time period is relative to the average.</p>
<p>Figures 4 and 5 display summary statistics (mean, standard deviation [sd], and number of observations [Nobs.] for the 1-day and 10-day smoothed residuals. The red line on the standard deviation plot is based on a lowess smooth. The standard deviations associated with the red line are used for computing confidence intervals.</p>
</div>
</div>
<div id="susquehanna-river-at-conowingo-md" class="section level2">
<h2 class="hasAnchor">
<a href="#susquehanna-river-at-conowingo-md" class="anchor"></a>01578310-Susquehanna River at Conowingo, MD</h2>
<p><img src="create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets_files/figure-html/flow1-1.png" width="624"></p>
<p><em>Figure 1. Daily Flow [cms] as a Function of Day of Year. (Solid red line is the predicted GAM model using the model: gam(LogQ ~ s(doy,bs=‘cc’)).)</em></p>
<p><img src="create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets_files/figure-html/flow1-2.png" width="624"></p>
<p><em>Figure 2. 1-day-smoothed Seasonally-adjusted Log Flow Residuals as a Function of Day of Year.</em></p>
<p><img src="create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets_files/figure-html/flow1-3.png" width="624"></p>
<p><em>Figure 3. 10-day-smoothed Seasonally-adjusted Log Flow Residuals as a Function of Day of Year.</em></p>
</div>
<div id="susquehanna-river-at-conowingo-md-avg--per--d1" class="section level2">
<h2 class="hasAnchor">
<a href="#susquehanna-river-at-conowingo-md-avg--per--d1" class="anchor"></a>01578310-Susquehanna River at Conowingo, MD (Avg. Per.: d1)</h2>
<p><img src="create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets_files/figure-html/flow1-4.png" width="624"></p>
<p><em>Figure: d1: Mean, standard deviation, and number of observations as a Function of Day of Year.</em></p>
</div>
<div id="susquehanna-river-at-conowingo-md-avg--per--d10" class="section level2">
<h2 class="hasAnchor">
<a href="#susquehanna-river-at-conowingo-md-avg--per--d10" class="anchor"></a>01578310-Susquehanna River at Conowingo, MD (Avg. Per.: d10)</h2>
<p><img src="create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets_files/figure-html/flow1-5.png" width="624"></p>
<p><em>Figure: d10: Mean, standard deviation, and number of observations as a Function of Day of Year.</em></p>
</div>
<div id="seasonally-detrended-salinity" class="section level2">
<h2 class="hasAnchor">
<a href="#seasonally-detrended-salinity" class="anchor"></a>Seasonally Detrended Salinity</h2>
<p>The function, <strong>detrended.salinity</strong>, returns a list of seasonally detrended salinity and companion statistics.</p>
<p><strong>It is the user’s responsibility to save the list that is returned from the detrended.salinity function as salinity.detrended for integration with baytrends.</strong></p>
<p>The detrended.salinity evaluates a user-supplied data set. baytrends includes a sample salinity data set, <strong>sal</strong>, that corresponds to the water quality data stored in <strong>dataCensored</strong>. Table 2 and Table 3 display some sample data and the structure of <strong>sal</strong>.</p>
<p><em>Table 2. Example Salinity Data</em></p>
<table class="table">
<thead><tr class="header">
<th align="left">station</th>
<th align="left">date</th>
<th align="left">layer</th>
<th align="right">salinity</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">LE3.6</td>
<td align="left">1984-06-27</td>
<td align="left">S</td>
<td align="right">11.71</td>
</tr>
<tr class="even">
<td align="left">LE3.6</td>
<td align="left">1984-06-27</td>
<td align="left">B</td>
<td align="right">13.44</td>
</tr>
<tr class="odd">
<td align="left">CB5.4</td>
<td align="left">1984-06-29</td>
<td align="left">S</td>
<td align="right">10.17</td>
</tr>
<tr class="even">
<td align="left">CB5.4</td>
<td align="left">1984-06-29</td>
<td align="left">B</td>
<td align="right">21.07</td>
</tr>
<tr class="odd">
<td align="left">CB5.1</td>
<td align="left">1984-07-10</td>
<td align="left">S</td>
<td align="right">8.69</td>
</tr>
<tr class="even">
<td align="left">LE3.6</td>
<td align="left">1984-07-11</td>
<td align="left">S</td>
<td align="right">12.90</td>
</tr>
</tbody>
</table>
<p><em>Table 3. Data Structure Associated with sal</em></p>
<pre><code>#&gt; 'data.frame':    51092 obs. of  4 variables:
#&gt;  $ station : chr  "LE3.6" "LE3.6" "LE3.6" "LE3.6" ...
#&gt;  $ date    : POSIXct, format: "1984-06-27" "1984-06-27" ...
#&gt;  $ layer   : chr  "S" "M" "M" "B" ...
#&gt;  $ salinity: num  11.7 12.1 12.6 13.4 21.6 ...</code></pre>
<p>The below code chunk is an example for analyzing all of the data contained in the sample data frame, sal. As currently developed, detrended.salinity will average salinity in the surface (‘S’) and above pycnocline (‘AP’) layers to create an average salinity value for the surface and above pycnocline (SAP) layer. detrended.salinity will also average salinity in the bottom (‘B’) and below pycnocline (‘AP’) layers to create an average salinity value for the bottom and below pycnocline (BAP) layer.</p>
<p>The use and settings for dvAvgWinSel, lowess.f, minObs, and minObs.sd are described in the help file. The detrened.salinity function will assume the user wants to evaluate the salinity for all of the stations in sal and for all the years of available data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># Define Function Inputs</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>df.sal      &lt;-<span class="st"> </span>sal</span>
<span id="cb4-4"><a href="#cb4-4"></a>dvAvgWinSel &lt;-<span class="st"> </span><span class="dv">30</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>lowess.f    &lt;-<span class="st"> </span><span class="fl">0.2</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>minObs      &lt;-<span class="st"> </span><span class="dv">40</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>minObs.sd   &lt;-<span class="st"> </span><span class="dv">10</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>                 </span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co"># Run Function</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>salinity.detrended &lt;-<span class="st"> </span><span class="kw"><a href="../reference/detrended.salinity.html">detrended.salinity</a></span>(df.sal, dvAvgWinSel, </span>
<span id="cb4-11"><a href="#cb4-11"></a>                                 lowess.f, minObs, minObs.sd)   </span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co"># Save list to data file separate use</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="kw"><a href="https://rdrr.io/r/base/save.html">save</a></span>(salinity.detrended, <span class="dt">file=</span><span class="st">'mySeasonallyDetrendedSalinity.rda'</span>)</span></code></pre></div>
<div id="example-1" class="section level3">
<h3 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example</h3>
<p>The below figures display summary statistics (mean, standard deviation [sd], and number of observations [Nobs.] for the SAP and BBP layers, respectively. The red line on the standard deviation plot is based on a lowess smooth. The standard deviations associated with the red line are used for computing confidence intervals.</p>
<p>The reader is referred to the help file for detrend.salinity to learn more about the procedure used to compute these statistics and how windowing is used address the issues related to sparse sampling.</p>
<p>[1] “CB5.4 (Surface: TRUE / Bottom: TRUE)” <img src="create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets_files/figure-html/salinity3-1.png" width="624"></p>
<p><em>Figure 1. SAP mean, standard deviation, and number of observations as a Function of Day of Year.</em></p>
<p><img src="create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets_files/figure-html/salinity3-2.png" width="624"></p>
<p><em>Figure 2. BBP mean, standard deviation, and number of observations as a Function of Day of Year.</em></p>
</div>
</div>
<div id="example-gam-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#example-gam-analysis" class="anchor"></a>Example GAM Analysis</h2>
<p>It is now possible to run gam4 using the results of the above analyses. The below code chunk will run the gam4 for surface total nitrogen at station CB5.4.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>dfr       &lt;-<span class="st"> </span><span class="kw"><a href="../reference/analysisOrganizeData.html">analysisOrganizeData</a></span>(dataCensored, <span class="dt">reports =</span> <span class="ot">NA</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>df        &lt;-<span class="st"> </span>dfr[[<span class="st">"df"</span>]]</span>
<span id="cb5-3"><a href="#cb5-3"></a>analySpec &lt;-<span class="st"> </span>dfr[[<span class="st">"analySpec"</span>]]</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># down select analyzed GAM</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>analySpec<span class="op">$</span>gamModels &lt;-<span class="st"> </span>analySpec<span class="op">$</span>gamModels[<span class="dv">5</span>]</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>stat =<span class="st"> 'CB5.4'</span>; dep =<span class="st"> 'tn'</span>; layer =<span class="st"> 'S'</span>;</span>
<span id="cb5-9"><a href="#cb5-9"></a>gamResult &lt;-<span class="st"> </span><span class="kw"><a href="../reference/gamTest.html">gamTest</a></span>(df, dep, stat, layer, analySpec</span>
<span id="cb5-10"><a href="#cb5-10"></a>                     , <span class="dt">salinity.detrended=</span>salinity.detrended)</span></code></pre></div>
<div id="total-nitrogen---non-linear-trend-with-seasint--hydro-adj" class="section level4">
<h4 class="hasAnchor">
<a href="#total-nitrogen---non-linear-trend-with-seasint--hydro-adj" class="anchor"></a>Total Nitrogen - Non-linear trend with Seas+Int. &amp; Hydro Adj</h4>
<p><img src="create_Seasonally_Detrended_Flow_and_Salinity_Data_Sets_files/figure-html/gamTrendExample-1.png" width="624"></p>
<p><em>Table: GAM Analysis of Variance.</em></p>
<table class="table">
<thead><tr class="header">
<th align="left">Type</th>
<th align="right">Source</th>
<th align="right">edf</th>
<th align="right">F-stat</th>
<th align="right">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">parametric terms</td>
<td align="right">cyear</td>
<td align="right">1.00</td>
<td align="right">1.2626</td>
<td align="right">0.2618</td>
</tr>
<tr class="even">
<td align="left">smoothed terms</td>
<td align="right">s(cyear)</td>
<td align="right">5.98</td>
<td align="right">6.2500</td>
<td align="right">&lt;0.0001</td>
</tr>
<tr class="odd">
<td align="left">" "</td>
<td align="right">s(doy)</td>
<td align="right">7.06</td>
<td align="right">35.9148</td>
<td align="right">&lt;0.0001</td>
</tr>
<tr class="even">
<td align="left">" "</td>
<td align="right">ti(cyear,doy)</td>
<td align="right">5.64</td>
<td align="right">2.7871</td>
<td align="right">&lt;0.0001</td>
</tr>
<tr class="odd">
<td align="left">" "</td>
<td align="right">s(flw_sal)</td>
<td align="right">2.40</td>
<td align="right">81.7670</td>
<td align="right">&lt;0.0001</td>
</tr>
<tr class="even">
<td align="left">" "</td>
<td align="right">ti(flw_sal,doy)</td>
<td align="right">5.14</td>
<td align="right">5.5401</td>
<td align="right">&lt;0.0001</td>
</tr>
<tr class="odd">
<td align="left">" "</td>
<td align="right">ti(flw_sal,cyear)</td>
<td align="right">5.85</td>
<td align="right">3.3318</td>
<td align="right">0.0016</td>
</tr>
<tr class="even">
<td align="left">" "</td>
<td align="right">ti(flw_sal,doy,cyear)</td>
<td align="right">1.88</td>
<td align="right">0.1106</td>
<td align="right">0.0239</td>
</tr>
</tbody>
</table>
<p><em>Table: GAM Parameter Coefficients.</em></p>
<table class="table">
<thead><tr class="header">
<th align="left">Parameter</th>
<th align="right">Estimate</th>
<th align="right">Std. Err.</th>
<th align="right">t value</th>
<th align="right">p-value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-0.621706</td>
<td align="right">0.012134</td>
<td align="right">-51.2353</td>
<td align="right">&lt;0.0001</td>
</tr>
<tr class="even">
<td align="left">cyear</td>
<td align="right">0.014114</td>
<td align="right">0.012560</td>
<td align="right">1.1237</td>
<td align="right">0.2618</td>
</tr>
</tbody>
</table>
<p><em>Table: GAM Diagnostics.</em></p>
<table class="table">
<thead><tr class="header">
<th align="right">AIC</th>
<th align="right">RMSE</th>
<th align="right">Adj. R-squared</th>
</tr></thead>
<tbody><tr class="odd">
<td align="right">-442.97</td>
<td align="right">0.1398</td>
<td align="right">0.7294</td>
</tr></tbody>
</table>
<p><em>Table: Estimates of Change from 1985-2016.</em></p>
<table class="table">
<thead><tr class="header">
<th align="left">Calculation</th>
<th align="center">Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Baseline log mean (geometric mean)</td>
<td align="center">-0.4394 (0.6444)</td>
</tr>
<tr class="even">
<td align="left">Current log mean (geometric mean)</td>
<td align="center">-0.818 (0.4413)</td>
</tr>
<tr class="odd">
<td align="left">Estimated log difference</td>
<td align="center">-0.3786</td>
</tr>
<tr class="even">
<td align="left">Std. Err. log difference</td>
<td align="center">0.0468</td>
</tr>
<tr class="odd">
<td align="left">95% Confidence interval for log difference</td>
<td align="center">(-0.4704 , -0.2868)</td>
</tr>
<tr class="even">
<td align="left">Difference p-value</td>
<td align="center">&lt;0.0001</td>
</tr>
<tr class="odd">
<td align="left">Period of Record Percent Change Estimate (%)</td>
<td align="center">-31.52%</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#purpose">Purpose</a></li>
      <li><a href="#load-baytrends">Load baytrends</a></li>
      <li><a href="#seasonally-detrended-flow">Seasonally Detrended Flow</a></li>
      <li><a href="#susquehanna-river-at-conowingo-md">01578310-Susquehanna River at Conowingo, MD</a></li>
      <li><a href="#susquehanna-river-at-conowingo-md-avg--per--d1">01578310-Susquehanna River at Conowingo, MD (Avg. Per.: d1)</a></li>
      <li><a href="#susquehanna-river-at-conowingo-md-avg--per--d10">01578310-Susquehanna River at Conowingo, MD (Avg. Per.: d10)</a></li>
      <li><a href="#seasonally-detrended-salinity">Seasonally Detrended Salinity</a></li>
      <li><a href="#example-gam-analysis">Example GAM Analysis</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Erik Leppo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
